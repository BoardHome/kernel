// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2020 Rockchip Electronics Co., Ltd.
 *
 */

#include "rk3568-firefly-port.dtsi"

/ {

	vcc_hub_power: vcc-hub-power-regulator {
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio3 RK_PA2 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&vcc_hub_power_en>;
		regulator-name = "vcc_hub_power_en";
		regulator-always-on;
	};

	vcc_hub_reset: vcc-hub-reset-regulator {
		compatible = "regulator-fixed";
		enable-active-high;
		gpio = <&gpio3 RK_PA6 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&vcc_hub_reset_en>;
		regulator-name = "vcc_hub_reset_en";
		regulator-always-on;
	};

    pcie_pi6c_oe: pcie-pi6c-oe-regulator {
		compatible = "regulator-fixed";
		//enable-active-high;
		gpio = <&gpio3 RK_PA7 GPIO_ACTIVE_LOW>;
		pinctrl-names = "default";
		pinctrl-0 = <&pcie_pi6c_oe_en>;
		regulator-name = "pcie_pi6c_oe_en";
		regulator-always-on;
	};

    vcc_4g_power: vcc-4g-power-regulator {
        compatible = "regulator-fixed";
        enable-active-high;
        gpio = <&gpio0 RK_PB0 GPIO_ACTIVE_HIGH>;
        pinctrl-names = "default";
        pinctrl-0 = <&vcc_4g_power_en>;
        regulator-name = "vcc_4g_power_en";
        regulator-always-on;
    };

    vcc_cam_power: vcc-cam-power-regulator {
        compatible = "regulator-fixed";
		enable-active-high;
		gpios = <&pca9554 PCA_IO0_1 GPIO_ACTIVE_HIGH>;
        regulator-name = "vcc_cam_power_en";
        regulator-always-on;
    };

	firefly_leds: leds {
		status = "okay";
		compatible = "gpio-leds";

		power_led: power {
			label = "firefly:blue:power";
			linux,default-trigger = "ir-power-click";
			default-state = "on";
			gpios = <&gpio0 RK_PC0 GPIO_ACTIVE_HIGH>;
			pinctrl-names = "default";
			pinctrl-0 = <&led_power>;
		};

		user_led: user {
			label = "firefly:yellow:user";
			linux,default-trigger = "ir-user-click";
			default-state = "off";
			gpios = <&pca9555 PCA_IO1_2 GPIO_ACTIVE_LOW>;
		};

		fan_ctl: fan-ctl {
			label = "firefly:fan_ctl:user";
			linux,default-trigger = "ir-user-click";
			default-state = "on";
			gpios = <&pca9555 PCA_IO1_0 GPIO_ACTIVE_HIGH>;
		};

		cam_ir_led: cam-ir-led {
			label = "firefly:cam_ir:user";
			linux,default-trigger = "ir-user-click";
			default-state = "off";
			gpios = <&pca9554 PCA_IO0_0 GPIO_ACTIVE_HIGH>;
		};

    };

	pwm_leds: pwm-leds{
		status = "okay";
		compatible = "pwm-leds";

		cam_rgb_led: cam-rgb-led {
			label = "PWM-RGB";
			pwms = <&pwm11 0 25000 0>;
			max-brightness = <255>;
			init-brightness = <0>;
		};
	};
};

&csi2_dphy0 {
	status = "disabled";

	ports {
		#address-cells = <1>;
		#size-cells = <0>;
		port@0 {
			reg = <0>;
			#address-cells = <1>;
			#size-cells = <0>;

			mipi_in_ucam3: endpoint@4 {
				reg = <4>;
				remote-endpoint = <&xc7022b_out>;
				data-lanes = <1 2>;
			};
			mipi_in_ucam4: endpoint@5 {
				reg = <5>;
				remote-endpoint = <&xc6130b_out>;
				data-lanes = <1 2>;
			};
		};
		port@1 {
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;

			csidphy_out: endpoint@0 {
				reg = <0>;
				remote-endpoint = <&isp0_in>;
			};
		};
	};
};

&csi2_dphy1 {
	status = "okay";
	/*
	* dphy1 only used for split mode,
	* can be used  concurrently  with dphy2
	* full mode and split mode are mutually exclusive
	*/
	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;
			#address-cells = <1>;
			#size-cells = <0>;

			dphy1_in: endpoint@1 {
					reg = <1>;
					remote-endpoint = <&gc2053_out>;
					data-lanes = <1 2>;
			};
		};

		port@1 {
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;

			dphy1_out: endpoint@1 {
					reg = <1>;
					remote-endpoint = <&isp0_in>;
			};
		};
	};
};

&csi2_dphy2 {
	status = "okay";
	/*
	* dphy2 only used for split mode,
	* can be used  concurrently  with dphy1
	* full mode and split mode are mutually exclusive
	*/
	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			reg = <0>;
			#address-cells = <1>;
			#size-cells = <0>;

			dphy2_in: endpoint@1 {
					reg = <1>;
					remote-endpoint = <&gc2093_out>;
					data-lanes = <1 2>;
			};
		};

		port@1 {
			reg = <1>;
			#address-cells = <1>;
			#size-cells = <0>;

			dphy2_out: endpoint@1 {
					reg = <1>;
					remote-endpoint = <&isp1_in>;
			};
		};
	};
};

&rkisp_vir0 {
	status = "okay";

	port {
		#address-cells = <1>;
		#size-cells = <0>;

		isp0_in: endpoint@0 {
			reg = <0>;
			remote-endpoint = <&dphy1_out>;
		};
	};
};

&rkisp_vir1 {
	status = "okay";

	port {
		#address-cells = <1>;
		#size-cells = <0>;

		isp1_in: endpoint@0 {
			reg = <0>;
			remote-endpoint = <&dphy2_out>;
		};
	};
};

&i2c1 {
    status = "okay";
};

&i2c4 {
	status = "okay";
	XC7022b: XC7022b@1b {
		 status = "disabled";
		 compatible = "firefly,xc7022";
		 reg = <0x1b>;
		 clocks = <&cru CLK_CIF_OUT>;
		 clock-names = "xvclk";
		 //avdd-supply = <&vcc_mipi>;
		 pinctrl-names = "rockchip,camera_default";
		 pinctrl-0 = <&cif_clk>;

		 power-gpios = <&pca9555 PCA_IO0_2 GPIO_ACTIVE_HIGH>;
		 reset-gpios = <&pca9555 PCA_IO0_0 GPIO_ACTIVE_HIGH>;
		 pwdn-gpios = <&pca9555 PCA_IO0_1 GPIO_ACTIVE_HIGH>;

		 firefly,clkout-enabled-index = <0>;
		 rockchip,camera-module-index = <1>;
		 rockchip,camera-module-facing = "front";
		 rockchip,camera-module-name = "NC";
		 rockchip,camera-module-lens-name = "NC";
		 port {
			xc7022b_out: endpoint {
				 remote-endpoint = <&mipi_in_ucam3>;
				 data-lanes = <1 2>;
			 };
		 };
	};

	XC6130b: XC6130b@23 {
		 status = "disabled";
		 compatible = "firefly,xc7022";
		 reg = <0x23>;
		 clocks = <&cru CLK_CIF_OUT>;
		 clock-names = "xvclk";
		 pinctrl-names = "rockchip,camera_default";
		 pinctrl-0 = <&cif_clk>;

		 power-gpios = <&pca9555 PCA_IO0_2 GPIO_ACTIVE_HIGH>;
		 reset-gpios = <&pca9555 PCA_IO0_0 GPIO_ACTIVE_HIGH>;
		 pwdn-gpios = <&pca9555 PCA_IO0_1 GPIO_ACTIVE_HIGH>;

		 firefly,clkout-enabled-index = <0>;
		 rockchip,camera-module-index = <0>;
		 rockchip,camera-module-facing = "back";
		 rockchip,camera-module-name = "NC";
		 rockchip,camera-module-lens-name = "NC";
		 port {
			xc6130b_out: endpoint {
				 remote-endpoint = <&mipi_in_ucam4>;
				 data-lanes = <1 2>;
			 };
		 };
	};

	gc2053: gc2053@37 { //IR
		status = "okay";
		compatible = "galaxycore,gc2053";
		reg = <0x37>;

		power-domains = <&power RK3568_PD_VI>;
		clocks = <&pmucru CLK_WIFI>;
		clock-names = "xvclk";
		pinctrl-names = "default";
		pinctrl-0 = <&refclk_pins>;

		reset-gpios = <&pca9555 PCA_IO0_3 GPIO_ACTIVE_LOW>;
		pwdn-gpios = <&pca9555 PCA_IO0_4 GPIO_ACTIVE_LOW>;

		rockchip,camera-module-index = <0>;
		rockchip,camera-module-facing = "back";
		rockchip,camera-module-name = "YT-RV1109-2-V1";
		rockchip,camera-module-lens-name = "40IR-2MP-F20";
		port {
			gc2053_out: endpoint {
			remote-endpoint = <&dphy1_in>;
			data-lanes = <1 2>;
			};
		};
	};

	gc2093: gc2093b@7e{ //RGB
		status = "okay";
		compatible = "galaxycore,gc2093";
		reg = <0x7e>;

		power-domains = <&power RK3568_PD_VI>;
		clocks = <&cru CLK_CIF_OUT>;
		clock-names = "xvclk";

		reset-gpios = <&pca9555 PCA_IO0_0 GPIO_ACTIVE_LOW>;
		pwdn-gpios = <&pca9555 PCA_IO0_1 GPIO_ACTIVE_HIGH>;

		firefly,clkout-enabled-index = <0>;
		rockchip,camera-module-index = <1>;
		rockchip,camera-module-facing = "front";
		rockchip,camera-module-name = "YT-RV1109-2-V1";
		rockchip,camera-module-lens-name = "40IR-2MP-F20";
		port {
			gc2093_out: endpoint {
			remote-endpoint = <&dphy2_in>;
			data-lanes = <1 2>;
			};
		};
	};

	pca9554: gpio@20 {
		status = "okay";
		compatible = "nxp,pca9554";
		reg = <0x20>;
		gpio-controller;
		#gpio-cells = <2>;
		gpio-group-num = <500>;
	};
};

&pca9555 {
    status = "okay";
};

&i2c5 {
    status = "okay";
};

&hym8563 {
    status = "okay";
};

&mc3230 {
    status = "okay";
};

&uart3 {
	status = "okay";
};

&uart4 {
        status = "okay";
};

&spi1 {
	status = "okay";
};

&spi_wk2xxx {
	status = "okay";
};

&pcie30phy {
       status = "okay";
};

&pcie3x2 {
        reset-gpios = <&gpio2 RK_PD6 GPIO_ACTIVE_HIGH>;
        vpcie3v3-supply = <&pcie30_3v3>;

       status = "okay";
};

&its {
    status = "okay";
};

&can1 {
    status = "okay";
};

&can2 {
    status = "okay";
};

&gmac0 {
    status = "okay";
};

&gmac1 {
    status = "okay";
};

&rgmii_phy0 {
	led_status_value = <0x6940>;
};

&rgmii_phy1 {
	led_status_value = <0x6940>;
};

&uart8 {
	status = "okay";
};

&sdio_pwrseq {
	status = "okay";
	reset-gpios = <&gpio3 RK_PD5 GPIO_ACTIVE_LOW>;
	post-power-on-delay-ms = <100>;
};

&sdmmc2 {
	status = "okay";
	max-frequency = <100000000>;
};

&wireless_wlan {
	wifi_chip_type = "ap6275s";
	status = "okay";
};

&wireless_bluetooth {
	BT,wake_gpio     = <&gpio3 RK_PB5 GPIO_ACTIVE_HIGH>;
	BT,wake_host_irq = <&gpio2 RK_PD7 GPIO_ACTIVE_HIGH>;
	status = "okay";
};

&spdif_8ch{
    status = "disabled";
};

&rk809_codec {
    hp-ctl-gpios = <&gpio1 RK_PB0 GPIO_ACTIVE_HIGH>;
};

&rk809 {
    rtc {
        status = "disabled";
    };
};

&pwm7 {
	status = "okay";
};

&pwm11 {
	status = "okay";
	pinctrl-0 = <&pwm11m1_pins>;
};

&sata2 {
	status = "okay";
};

&pinctrl {

	usb {
		vcc_hub_power_en: vcc-hub-power-en {
			rockchip,pins = <3 RK_PA2 RK_FUNC_GPIO &pcfg_pull_none>;
		};

		vcc_hub_reset_en: vcc-hub-reset-en {
			rockchip,pins = <3 RK_PA6 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

    pcie {
        pcie_pi6c_oe_en: pcie-pi6c-oe-en {
			rockchip,pins = <3 RK_PA7 RK_FUNC_GPIO &pcfg_pull_none>;
		};
    };

	4g {
	    vcc_4g_power_en: vcc-4g-power-en {
	        rockchip,pins = <0 RK_PB0 RK_FUNC_GPIO &pcfg_pull_none>;
	    };
	};

	leds {
	    led_power: led-power {
	        rockchip,pins = <0 RK_PC0 RK_FUNC_GPIO &pcfg_pull_none>;
	    };
	};
};
